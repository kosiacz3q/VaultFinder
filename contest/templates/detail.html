{% extends "full.html" %}

{% block title %}{{ overseer.name }}{% endblock %}

{% block head %}
{% load staticfiles %}
<script src="{% static 'details/jquery.bracket.min.js' %}"></script>
<link rel="stylesheet" type="text/css" href="{% static 'details/jquery.bracket.min.css' %}" />
{% endblock %}

{% block content %}

{% load bootstrap3 %}

<div class="row">
    <h1>{{ overseer.name }}</h1>
</div>

<div class="row" style="margin-top:10px;">

    <div class="col-md-8 white-bg">

         <div class="col-sm-6" >
            <dl class="dl-horizontal">
                <dt>Description</dt>
                <dd>{{ overseer_contest.description }}</dd>
                <dt>Limit</dt>
                <dd>{{ count }}/{{ overseer_contest.limit }}</dd>
                <dt>Deadline</dt>
                <dd>{{ overseer_contest.deadline }}</dd>
                <dt>Start date</dt>
                <dd>{{ overseer_contest.date }}</dd>
                <dt>Sponsors</dt>
                {% for item in overseer_contest.sponsors.all %}
                <dd>{{ item.name }}</dd>
                {% endfor %}
            </dl>
         </div>

        <div class="col-sm-6" >
            {% if user == overseer_contest.organizer %}
            <a class="btn btn-default" role="button" href="{% url 'contest:edit' overseer_contest.id %}">Edit</a>
            {% endif %}
        </div>
    </div>

    <div class="col-md-4">
        <img src="https://maps.googleapis.com/maps/api/staticmap?zoom=13&size=300x300&maptype=roadmap&markers=color:blue|{{ overseer.latitude }},{{ overseer.longitude }}"
             class="img-rounded"/>
    </div>

    {% if user.is_authenticated %}
    <div>


        <a class="btn btn-default{% if enrolled != 0 %} disabled{% endif %}" role="button"
           {% if enrolled == 0 %}href="{% url 'contest:join' overseer_contest.id %}"{% endif %}>{% if enrolled != 0 %}You are already enrolled{% else %}Enroll{% endif %} </a>
    </div>
    {% endif %}

    <div class="white-bg">
        <h3 class="fallout-font">Participants of Overseer contest</h3>
        <table class="table table-condensed">
            <tr>
                <td>#</td>
                <td>Participant name</td>
                <td>Ranking</td>
            </tr>
            {% for item in enrollments %}
            <tr>
                <td>{{ forloop.counter }}</td>
                <td>{{ item.user }}</td>
                <td>{{ item.ranking }}</td>
            </tr>
            {% endfor %}
        </table>
    </div>

    <a class="btn btn-default" role="button" href="{% url 'contest:force_detail' overseer_contest.id 1 %}">Start!</a>

    {% if matches %}
        <h3>Matches</h3>
        <table class="table table-condensed">

            <tr>
                <td>Round</td>
                <td>Overseer candidate 1</td>
                <td>Overseer candidate 2</td>
                <td>Result</td>
            </tr>

            {% for item in matches %}
            <tr{% if item.player_1 == request.user or item.player_2 == request.user %} class="info"{% endif %}>
                <td>{{ item.round.name }}</td>
                <td{% if item.player_1 == item.winner %} style="font-weight: bold"{% endif %}>{{ item.player_1.first_name }}</td>
                <td{% if item.player_2 == item.winner %} style="font-weight: bold"{% endif %}>{{ item.player_2.first_name }}</td>
                <td>
                    {% if item.winner %}
                        {{ item.score }}
                    {% else %}
                        {% if item.last_filled and item.last_filled == request.user %}
                            Update
                        {% elif item.player_1 == request.user or item.player_2 == request.user %}
                            <a href="{% url 'contest:update_match' item.id %}">Update</a>
                        {% else %}
                            -
                        {% endif %}
                    {% endif %}
                </td>
            </tr>
            {% endfor %}

        </table>
        <div class="brackets">
    </div>
         <script type="text/javascript">
             var data = {{ bracket }}
             $('.brackets').bracket({
                skipSecondaryFinal: false,
                  init: data
             });

        </script>
    {% endif %}

</div>


{% endblock %}